<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi Tiết Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-6">

         <div class="mb-6">
            <a href="javascript:history.back()" class="text-blue-600 hover:underline text-sm">
                <i class="fas fa-arrow-left mr-2"></i>Quay Lại
            </a>
        </div>

        <div th:if="${tourDetails != null}" class="bg-white p-6 rounded-lg shadow-md mb-6">
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/3 flex-shrink-0">
                    <img th:src="@{${tourDetails.tour.hinhAnh}}" alt="Hình ảnh tour" class="rounded-lg w-full h-64 object-cover shadow-lg">
                </div>
                <div class="md:w-2/3">
                    <h1 class="text-3xl font-bold text-gray-800" th:text="${tourDetails.tour.tenTour}"></h1>
                    <p class="text-gray-600 mt-4" th:text="${tourDetails.tour.moTa}"></p>
                    <div class="mt-6 flex items-center flex-wrap gap-x-6 gap-y-2 text-gray-700">
                        <div class="flex items-center" title="Số ngày"><i class="fas fa-calendar-alt mr-2 text-blue-500"></i><span th:text="${tourDetails.tour.soNgay} + ' ngày'"></span></div>
                        <div class="flex items-center" title="Giá cơ bản"><i class="fas fa-money-bill-wave mr-2 text-green-500"></i><span th:text="${#numbers.formatDecimal(tourDetails.tour.giaCoBan, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></span></div>
                    </div>
                </div>
            </div>
        </div>

        <div x-data="{ activeTab: 'trips' }" class="w-full">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button @click="activeTab = 'trips'" :class="{ 'border-blue-500 text-blue-600': activeTab === 'trips', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'trips' }" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Danh Sách Chuyến Đi</button>
                    <button @click="activeTab = 'itinerary'" :class="{ 'border-blue-500 text-blue-600': activeTab === 'itinerary', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'itinerary' }" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Lộ Trình Tour</button>
                </nav>
            </div>
            <div>
                <div x-show="activeTab === 'trips'" class="mt-6">
                     <div class="bg-white rounded-lg shadow-md overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-600">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3">Mã Chuyến</th><th class="px-6 py-3">Ngày Bắt Đầu</th><th class="px-6 py-3">Ngày Kết Thúc</th><th class="px-6 py-3">Trạng Thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:if="${#lists.isEmpty(tourDetails.danhSachChuyen)}"><td colspan="4" class="text-center py-4 text-gray-500">Chưa có chuyến đi nào được mở cho tour này.</td></tr>
                                <tr th:each="chuyen : ${tourDetails.danhSachChuyen}" class="bg-white border-b hover:bg-gray-50">
                                    <td class="px-6 py-4" th:text="${chuyen.maChuyen}"></td>
                                    <td class="px-6 py-4" th:text="${#temporals.format(chuyen.ngayBatDau, 'dd-MM-yyyy')}"></td>
                                    <td class="px-6 py-4" th:text="${#temporals.format(chuyen.ngayKetThuc, 'dd-MM-yyyy')}"></td>
                                    <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-medium rounded-full" th:text="${chuyen.trangThai}" th:classappend="${chuyen.trangThai == 'Sắp diễn ra' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'}"></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div x-show="activeTab === 'itinerary'" class="mt-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                         <div class="space-y-8">
                            <div th:each="lt : ${tourDetails.lichTrinh}" class="relative pl-10">
                                <div class="absolute left-0 top-1 h-full border-l-2 border-blue-200 ml-3"></div>
                                <div class="absolute left-0 top-1 w-6 h-6 bg-blue-500 rounded-full border-4 border-white flex items-center justify-center text-white text-xs font-bold" th:text="${lt.thuTuNgay}"></div>
                                <p class="font-semibold text-lg text-gray-800" th:text="${lt.hoatDong}"></p>
                                <div class="mt-2 space-y-1 text-sm text-gray-600">
                                    <p th:if="${lt.diaDiem != null}"><i class="fas fa-map-marker-alt w-5 text-center text-red-500 mr-2"></i><strong class="font-semibold">Địa điểm:</strong> <span th:text="${lt.diaDiem.tenDiaDiem}"></span></p>
                                </div>
                            </div>
                             <div th:if="${#lists.isEmpty(tourDetails.lichTrinh)}">
                                <p class="text-gray-500">Chưa có lịch trình chi tiết cho tour này.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>