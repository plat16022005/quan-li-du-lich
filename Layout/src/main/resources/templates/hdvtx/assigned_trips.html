<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Chuyến Đã Nhận</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script
	src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js"
	defer></script>
</head>
<body class="bg-gray-100">
	<div class="flex h-screen overflow-hidden">
		<aside th:replace="~{hdvtx/dashboard :: aside}"></aside>

		<div class="flex-1 flex flex-col overflow-y-auto">
			<header th:replace="~{hdvtx/dashboard :: header}"></header>

			<main class="flex-1 p-6">
				<h2 class="text-2xl font-bold text-gray-800 mb-6">Các Chuyến Đi
					Bạn Đã Nhận</h2>

				<div th:if="${successMessage}"
					class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4"
					role="alert">
					<span class="block sm:inline" th:text="${successMessage}"></span>
				</div>
				<div th:if="${errorMessage}"
					class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"
					role="alert">
					<span class="block sm:inline" th:text="${errorMessage}"></span>
				</div>

				<div class="bg-white rounded-lg shadow-md overflow-x-auto">
					<table class="w-full text-sm text-left text-gray-600">
						<thead class="text-xs text-gray-700 uppercase bg-gray-50">
							<tr>
								<th class="px-6 py-3">Mã Chuyến</th>
								<th class="px-6 py-3">Tên Tour</th>
								<th class="px-6 py-3">Ngày Khởi Hành</th>
								<th class="px-6 py-3">Số Ngày</th>
								<th class="px-6 py-3">Hành Khách</th>
								<th class="px-6 py-3">Trạng Thái</th>
								<th class="px-6 py-3 text-center">Hành Động</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${#lists.isEmpty(assignedTrips)}">
								<td colspan="7" class="text-center py-4 text-gray-500">Bạn
									chưa nhận chuyến đi nào.</td>
							</tr>
							<tr th:each="chuyen : ${assignedTrips}"
								class="bg-white border-b hover:bg-gray-50">
								<td class="px-6 py-4 font-medium text-gray-900"
									th:text="${chuyen.maChuyen}"></td>
								<td class="px-6 py-4"
									th:text="${chuyen.tour?.tenTour ?: 'Chuyến riêng lẻ'}"></td>
								<td class="px-6 py-4"
									th:text="${#temporals.format(chuyen.ngayBatDau, 'dd/MM/yyyy')}"></td>
								<td class="px-6 py-4" th:text="${chuyen.getSoNgay()}"></td>
								<td class="px-6 py-4"
									th:text="${chuyen.soLuongHienTai + ' / ' + chuyen.soLuongToiDa}"></td>
								<td class="px-6 py-4"><span
									th:if="${chuyen.trangThai == 'Đang diễn ra'}"
									class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-semibold">
										<i class="fas fa-play-circle mr-1"></i>Đang diễn ra
								</span> <span th:if="${chuyen.trangThai == 'Sắp diễn ra'}"
									class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-semibold">
										<i class="fas fa-clock mr-1"></i>Sắp diễn ra
								</span> <span
									th:if="${chuyen.trangThai == 'Đã hoàn thành' || chuyen.trangThai == 'Đã kết thúc'}"
									class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs font-semibold">
										<i class="fas fa-check-circle mr-1"></i>Đã hoàn thành
								</span></td>
								<td class="px-6 py-4 text-center space-x-4"><a
									th:href="@{/hdvtx/trip-details/{id}/download(id=${chuyen.maChuyen})}"
									class="font-medium text-blue-600 hover:underline inline-flex items-center">
										<i class="fas fa-download mr-1"></i>Lịch trình
								</a> <!-- ✅ Chỉ cho hủy nếu chuyến chưa hoàn thành --> <span
									th:if="${chuyen.trangThai != 'Đã hoàn thành' && chuyen.trangThai != 'Đã kết thúc'}">
										<form
											th:action="@{/hdvtx/trips/cancel/{tripId}(tripId=${chuyen.maChuyen})}"
											method="post" class="inline"
											onsubmit="return confirm('Bạn có chắc muốn hủy nhận chuyến này không?');">
											<button type="submit"
												class="font-medium text-red-600 hover:underline">
												<i class="fas fa-times-circle mr-1"></i>Hủy
											</button>
										</form>
								</span> <!-- ✅ Hiển thị thông báo nếu chuyến đã hoàn thành --> <span
									th:if="${chuyen.trangThai == 'Đã hoàn thành' || chuyen.trangThai == 'Đã kết thúc'}"
									class="text-gray-400 text-xs italic"> <i
										class="fas fa-lock mr-1"></i>Không thể hủy
								</span></td>
							</tr>
						</tbody>
					</table>
				</div>
			</main>
		</div>
	</div>
</body>
</html>